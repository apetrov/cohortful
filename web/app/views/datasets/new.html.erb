<% content_for :title, 'Create Dataset' %>
<% content_for :body_class, 'bg-body-tertiary min-vh-100 py-5' %>

<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-xl-7">
      <div class="card shadow-sm border-0">
        <div class="card-header border-bottom bg-white">
          <h1 class="h4 mb-1">Upload Cohort Dataset</h1>
          <p class="text-body-secondary mb-0">Provide the column headers we should ingest alongside your CSV file.</p>
        </div>
        <div class="card-body">
          <% if flash[:notice] %>
            <div class="alert alert-success d-flex align-items-center gap-2 mb-4" role="alert">
              <i class="cil-check-circle"></i>
              <span><%= flash[:notice] %></span>
            </div>
          <% end %>

          <% if flash[:alert] %>
            <div class="alert alert-warning d-flex align-items-center gap-2 mb-4" role="alert">
              <i class="cil-warning"></i>
              <span><%= flash[:alert] %></span>
            </div>
          <% end %>

          <% if @dataset.errors.any? %>
            <div class="alert alert-danger mb-4" role="alert">
              <p class="mb-2 fw-semibold"><%= pluralize(@dataset.errors.count, 'error') %> prevented this dataset from saving:</p>
              <ul class="mb-0">
                <% @dataset.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <%= form_with model: @dataset, url: datasets_path, local: true, html: { multipart: true, class: 'needs-validation' } do |form| %>
            <div class="row g-4">
              <div class="col-md-6">
                <%= form.label :feature_name, class: 'form-label' %>
                <%= form.text_field :feature_name, required: true, class: 'form-control', placeholder: 'e.g. feature' %>
              </div>

              <div class="col-md-6">
                <%= form.label :size_name, class: 'form-label' %>
                <%= form.text_field :size_name, required: true, class: 'form-control', min: 1, placeholder: 'e.g. cohort_size' %>
              </div>

              <div class="col-md-6">
                <%= form.label :arpu_name, class: 'form-label' %>
                <%= form.text_field :arpu_name, required: true, step: :any, class: 'form-control', placeholder: 'e.g. arpu' %>
              </div>

              <div class="col-md-6">
                <%= form.label :arpu_std_name, 'ARPU Std Dev', class: 'form-label' %>
                <%= form.text_field :arpu_std_name, required: true, step: :any, class: 'form-control', placeholder: 'e.g. arpu_std' %>
              </div>

              <div class="col-12">
                <%= form.label :file, 'CSV file', class: 'form-label' %>
                <%= form.file_field :file, required: true, accept: '.csv,text/csv', class: 'form-control' %>
                <div class="form-text">Upload a UTF-8 encoded CSV. We convert it to Parquet before persisting.</div>
              </div>
            </div>

            <div class="d-flex justify-content-end mt-4">
              <%= form.submit 'Create Dataset', class: 'btn btn-primary px-4' %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
